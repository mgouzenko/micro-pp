<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Micro++: Benchmarks: Speed Tests, Clarity, and Ease of Use.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Micro++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Benchmarks: Speed Tests, Clarity, and Ease of Use. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>In this section, we will compare <b>micro</b> to other web frameworks. Namely, we benchmark <b>micro</b> against <b>Flask</b>, a python framework, and <b>wt</b>, a widget-oriented C++ framework. In addition to speed tests, we examine source code for a "hello world" web application for all three frameworks. In our analyses, we comment on ease of use as well as speed.</p>
<p>We have chosen to benchmark against <b>Flask</b> because this framework is a large inspiration for the type of functionality we hope to provide with <b>micro</b>. We have also chosen to benchmark against <b>wt</b> because it is the leading web framework for C++.</p>
<h2>Speed Tests</h2>
<p>In this section, we stress-tested all three frameworks using their built-in servers. For all tests, we used <b>Apache Benchmark</b> to send requests at a varying level of concurrency. In the first scenario, we had the frameworks render a dynamic response based on the content of the request. In the second scenario, we had each framework render a static image. In all tests, the webapps were run from within a two-core virtual machine and accessed via host-only networking - so that the results would not be influence by noise over the local network. The virtual machine has the following specs:</p>
<div class="image">
<img src="../specs.png"  alt="specs" style="width: 70vw"/>
</div>
<h3>Dynamic Test</h3>
<p>In the dynamic tests, we sent a single request containing both url and post parameters. The exact request sent was:</p>
<div class="fragment"><div class="line">POST /?fname=Mitchell&amp;lname=Gouzenko HTTP/1.1</div>
<div class="line">Host: vbox:8080</div>
<div class="line">Cache-Control: no-cache</div>
<div class="line">Content-Type: application/x-www-form-urlencoded</div>
<div class="line"></div>
<div class="line">color=blue</div>
</div><!-- fragment --><p>For each web framwork, we created a simple webapp that would respond with the single message: "Hello &lt;fname&gt; &lt;lname&gt;, your favorite color is &lt;color&gt;." (The appropriate parameters were of course inserted into this message.) We sent 10,000 requests to each application - first at a concurrency level of 100 and then at a concurrency level of 10. The results of the tests are below.</p>
<div class="image">
<img src="../dynamic.png"  alt="Dynamic" style="width: 70vw"/>
</div>
<p>In terms of total time taken to respond to the requests, <b>micro</b> was fastest for both levels of concurrency. In second place was <b>Flask</b> and <b>wt</b> took last place. However, we must be careful in our analysis. A more accurate picture can be observed by looking at bytes transferred per second for each framework. In this case, <b>wt</b> takes the lead, with <b>micro</b> in second place and <b>Flask</b> in third.</p>
<p>This leads us to take note of the fact that <b>wt</b> sent a total of about 48 million bytes, approximately 48 times the bytes that <b>micro</b> sent, and 24 times the bytes that <b>Flask</b> sent. That is, <b>wt</b> clearly has the largest footprint of the three frameworks. <b>wt</b> has a heavy front-end because it is widget-centric and by default uses a large amount of css and javascript.</p>
<p>Nonetheless, <b>wt</b> is almost on par with <b>Flask</b>. The <b>Flask</b> built-in server is not asynchronous, and its speed suffers as a results. On the other hand, <b>wt</b> is based "on event-driven async I/O," and uses threads "to improve concurrent request handling". Evidently, <b>micro</b> and <b>wt</b> share very similar server logic. This brings into question why <b>wt</b> had such a high byte transfer rate compared to that of <b>micro</b>. That question is explored in the following experiment:</p>
<h3>Static Test</h3>
<p>In this test, we have each framework serve a static image, and nothing more.</p>
<div class="image">
<img src="../static.png"  alt="Static" style="max-width: 70vw"/>
</div>
<p>The results are interesting. During dynamic tests, <b>wt</b> was much faster than <b>micro</b> in terms of bytes per second. Yet during the static test, <b>wt</b> only beat <b>micro</b> by a small amount. That is, when <b>wt</b> and <b>micro</b> serve the same amount of static data, they operate at almost the same speed. This suggests that during dynamic testing, sending so much data over the network was not the speed bottleneck for <b>wt</b>. Indeed, during static testing, <b>wt</b> sends much more data in a shorter time. Therefore we hypothesize that in the dynamic case <b>wt</b> performed slower than <b>micro</b> because <b>wt</b> took longer to invoke the dynamic callback function.</p>
<p>This is an important conclusion: <b>wt</b> was not slower than <b>micro</b> due to the large amount of data it was serving. Instead, it was slower than <b>micro</b> because it took longer for <b>wt</b> to respond to a dynamic request. Or, on the other hand, <b>micro</b> is highly optimized for responding to dynamic requests!</p>
<h3>Optimizations for URL Resolution</h3>
<p>Why is micro so fast? We hypothesize that it was due to our design decision to store <b>url_route**s in a vector. As explained in the documentation, a **url_route</b> is one of our custom classes that groups callback function together with a regex statement. When a client requests a url enpoint that matches that regex statement, the associated callback gets invoked. Matching a url endpoint takes place in the <b>url_route::match</b> member function. That is, the url_route checks itself to see if it can be matched with the supplied endpoint. The <b>url_routes</b> are iterated over linearly until a match is found.</p>
<p>It is important that all of this is done in a vector. Because the <b>url_routes</b> are stored contiguously in memory, they are prefetched into the cache together. Thus, iterating over all of the url_routes is blazingly fast because the match function operates on objects sitting in cache. Earlier, we implemented the data structure for **url_route**s as an unordered map of regex expressions to url objects. This version was much slower - though we do not currently have the exact numbers. In the future, we hope to test our framework with the hashmap implementation to see if the vectorization of **url_route**s is really the source of speed in URL resolution.</p>
<h2>Convenience and Ease of Use</h2>
<p>In this section, we have posted the code that we wrote for each web framework to serve the dynamic and static pages. "Ease of use" is a rather subjective term, so you can decide for yourself which framework is the most simple!</p>
<h3>Flask</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#!/usr/bin/python</span></div>
<div class="line">from flask <span class="keyword">import</span> Flask, render_template, request, session, redirect, url_for</div>
<div class="line"><span class="keyword">import</span> os </div>
<div class="line"></div>
<div class="line">app = Flask(__name__, static_folder= os.path.abspath(<span class="stringliteral">&quot;../static&quot;</span> ), static_url_path=<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"></div>
<div class="line">print os.path.abspath(<span class="stringliteral">&quot;../static&quot;</span> )</div>
<div class="line">@app.route(<span class="charliteral">&#39;/&#39;</span>, methods=[<span class="stringliteral">&#39;GET&#39;</span>, <span class="stringliteral">&#39;POST&#39;</span>]) </div>
<div class="line">def home():</div>
<div class="line">    fname = request.args.get(<span class="stringliteral">&quot;fname&quot;</span>)</div>
<div class="line">    lname = request.args.get(<span class="stringliteral">&quot;lname&quot;</span>)</div>
<div class="line">    color = request.form.get(<span class="stringliteral">&#39;color&#39;</span>)</div>
<div class="line">    return <span class="stringliteral">&quot;Hello %(fname)s %(lname)s, your favorite color is %(color)s&quot;</span> % {<span class="stringliteral">&#39;fname&#39;</span>:fname, <span class="stringliteral">&#39;lname&#39;</span>:lname, <span class="stringliteral">&#39;color&#39;</span>:color}  </div>
<div class="line"></div>
<div class="line">@app.route(<span class="stringliteral">&#39;/static_test&#39;</span>, methods=[<span class="stringliteral">&#39;GET&#39;</span>, <span class="stringliteral">&#39;POST&#39;</span>])</div>
<div class="line">def stat():</div>
<div class="line">    return app.send_static_file(<span class="stringliteral">&#39;static_test.jpg&#39;</span>)</div>
<div class="line"></div>
<div class="line">if __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line">    app.run(<span class="stringliteral">&quot;0.0.0.0&quot;</span>, port=8080)</div>
</div><!-- fragment --><h3>micro</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;micro/app.hpp&gt;</span> </div>
<div class="line"><span class="preprocessor">#include &lt;micro/request.hpp&gt;</span> </div>
<div class="line"><span class="preprocessor">#include &lt;micro/response.hpp&gt;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="classmicro_1_1response.html">micro::response</a> home(<span class="keyword">const</span> <a class="code" href="classmicro_1_1request.html">micro::request</a>&amp; req){</div>
<div class="line">    <a class="code" href="classmicro_1_1response.html">micro::response</a> resp; </div>
<div class="line"></div>
<div class="line">    std::string fname = req.<a class="code" href="classmicro_1_1request.html#af4e74a331ce71bcb481e006ef4047545">get_query_param</a>(<span class="stringliteral">&quot;fname&quot;</span>); </div>
<div class="line">    std::string lname = req.<a class="code" href="classmicro_1_1request.html#af4e74a331ce71bcb481e006ef4047545">get_query_param</a>(<span class="stringliteral">&quot;lname&quot;</span>); </div>
<div class="line">    std::string color = req.<a class="code" href="classmicro_1_1request.html#a0fa6af8cf6c5036545d4766790e2950f">get_cookie</a>(<span class="stringliteral">&quot;color&quot;</span>); </div>
<div class="line"></div>
<div class="line">    resp.<a class="code" href="classmicro_1_1response.html#a2df7cb34f7700a040e1cf7d41360abf4">render_string</a>(<span class="stringliteral">&quot;Hello &quot;</span> + fname + <span class="stringliteral">&quot; &quot;</span> + lname + <span class="stringliteral">&quot;, your favorite color is &quot;</span> + color + <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> resp; </div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <a class="code" href="classmicro_1_1app.html">micro::app</a> application;</div>
<div class="line">    application.<a class="code" href="classmicro_1_1app.html#add07670b87b2dc2c7758aabdb365a2a8">set_static_root</a>(<span class="stringliteral">&quot;../static/&quot;</span>); </div>
<div class="line">    application.add_route(<span class="stringliteral">&quot;/&quot;</span>, home); </div>
<div class="line">    application.<a class="code" href="classmicro_1_1app.html#a1fcc51d0124373d86d98d0a6a6cc343a">run</a>(); </div>
<div class="line">}</div>
</div><!-- fragment --><h3>Wt</h3>
<div class="fragment"><div class="line">HelloApplication::HelloApplication(<span class="keyword">const</span> WEnvironment&amp; env)</div>
<div class="line">  : WApplication(env)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> std::string none = <span class="stringliteral">&quot;NONE&quot;</span>; </div>
<div class="line">  setTitle(<span class="stringliteral">&quot;Hello world&quot;</span>);<span class="comment">// application title</span></div>
<div class="line">  <span class="keyword">const</span> std::string *fname = env.getParameter(<span class="stringliteral">&quot;fname&quot;</span>); </div>
<div class="line">  <span class="keyword">const</span> std::string *lname = env.getParameter(<span class="stringliteral">&quot;lname&quot;</span>);</div>
<div class="line">  <span class="keyword">const</span> std::string *color = env.getParameter(<span class="stringliteral">&quot;color&quot;</span>); </div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(fname == 0) fname = &amp;none; </div>
<div class="line">  <span class="keywordflow">if</span>(lname == 0) lname = &amp;none;</div>
<div class="line">  <span class="keywordflow">if</span>(color == 0) color = &amp;none; </div>
<div class="line"></div>
<div class="line">  root()-&gt;addWidget(<span class="keyword">new</span> WText(<span class="stringliteral">&quot;Hello &quot;</span> + *fname + <span class="stringliteral">&quot; &quot;</span> + *lname + <span class="stringliteral">&quot;, your favorite color is &quot;</span> + *color+ <span class="stringliteral">&quot;.&quot;</span>));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">WApplication *createApplication(<span class="keyword">const</span> WEnvironment&amp; env)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">new</span> HelloApplication(env);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> WRun(argc, argv, &amp;createApplication);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 30 2015 22:30:20 for Micro++ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
